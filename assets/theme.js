(()=>{function d(){let s=document.querySelectorAll("[data-nutri-open]"),t=document.querySelector("[data-nutri-overlay]"),e=document.querySelector("[data-nutri-popup]"),n=document.querySelector("[data-nutri-close]");if(!s.length||!t||!e||!n)return;function i(){t.classList.remove("hidden"),e.classList.remove("hidden"),document.body.style.overflow="hidden"}function a(){t.classList.add("hidden"),e.classList.add("hidden"),document.body.style.overflow=""}s.forEach(r=>r.addEventListener("click",i)),t.addEventListener("click",a),n.addEventListener("click",a)}function u(){let s=document.querySelectorAll('a[href="#ravekit-product"]');s.length&&s.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();let n=document.getElementById("ravekit-product");n&&n.scrollIntoView({behavior:"smooth",block:"start"})})})}function y(s){let t=!1;return function(...e){t||(window.requestAnimationFrame(()=>{s(...e),t=!1}),t=!0)}}function h(){let s=Array.from(document.querySelectorAll("[data-parallax-speed]")).filter(i=>!i.classList.contains("alien_ravekit")).map(i=>({el:i,speed:parseFloat(i.dataset.parallaxSpeed)})),t=Array.from(document.querySelectorAll("[data-rotate-on-scroll]")).filter(i=>!i.classList.contains("alien_ravekit")).map(i=>({el:i,factor:parseFloat(i.dataset.rotateOnScroll)})),e=Array.from(document.querySelectorAll(".alien_ravekit")),n=()=>{let i=window.scrollY,a=window.innerHeight;s.forEach(({el:r,speed:o})=>{r.style.transform=`translateY(${i*o}px)`}),t.forEach(({el:r,factor:o})=>{let l=r.style.transform.replace(/rotate\([^)]+\)/,"");r.style.transform=`${l} rotate(${i*o}deg)`}),e.forEach(r=>{let o=r.getBoundingClientRect(),m=Math.min(Math.max((a-o.top)/(a+o.height),0),1)*180;r.style.transform=`rotate(${m}deg)`})};window.addEventListener("scroll",y(n)),n()}function p(){let s=document.querySelectorAll("[data-accordion-trigger]"),t=document.querySelectorAll("[data-accordion-content]");if(!s.length||!t.length){console.warn("No titles or contents found for science accordion.");return}s.forEach(e=>{e.addEventListener("click",n=>{let i=e.dataset.index;s.forEach(r=>r.classList.remove("is-active")),t.forEach(r=>r.classList.remove("is-active")),e.classList.add("is-active");let a=document.querySelector(`.science-accordion__item-content[data-content-index="${i}"]`);a?a.classList.add("is-active"):console.warn("No content found for index:",i)})})}function f(){let s=document.querySelector("[data-banner-text]"),t=document.querySelector(".free-shipping-banner__spacer");if(!s||!t)return;let e=s.offsetHeight;t.style.height=`${e}px`;let n=s.getBoundingClientRect().top+window.scrollY;function i(){window.scrollY>=n?s.classList.add("free-shipping-banner__text-container--sticky"):s.classList.remove("free-shipping-banner__text-container--sticky")}window.addEventListener("scroll",i),i()}var c=class{constructor(t){this.container=t;let e=document.getElementById("RavekitProductData");this.data=e?JSON.parse(e.textContent):{},this.settings=this.data.settings||{},this.variants=this.data.variants||[],this.variantBtns=t.querySelectorAll(".variant-button"),this.qtyDec=t.querySelector(".quantity-decrease"),this.qtyInc=t.querySelector(".quantity-increase"),this.qtyInput=t.querySelector(".quantity-input"),this.addBtn=t.querySelector(".add-to-cart"),this.btnSurface=this.addBtn.querySelector(".push-btn__surface .btn-price"),this.radioSingle=t.querySelector('input[value="single"]'),this.radioSub=t.querySelector('input[value="subscription"]'),this.singlePrice=t.querySelector(".single-price"),this.subsPrice=t.querySelector(".subs-price"),this.planSelect=t.querySelector("#selling_plan_select"),this.timerBlock=t.querySelector(".free-shipping-timer"),this.timerTextEl=t.querySelector(".timer-text"),this.timerCountEl=t.querySelector(".timer-countdown"),this.timerSuffix=t.querySelector(".timer-suffix"),this.selectedVariant=null,this.purchaseType="single",this.timerId=null,this.init()}init(){this.variantBtns.length&&(this.variantBtns[0].classList.add("selected"),this.onVariantChange(this.variantBtns[0].dataset.variantId)),this.bind(),this.updateButtonPrice()}bind(){this.variantBtns.forEach(t=>t.addEventListener("click",()=>{this.variantBtns.forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),this.onVariantChange(t.dataset.variantId)})),this.qtyDec.addEventListener("click",()=>this.changeQty(-1)),this.qtyInc.addEventListener("click",()=>this.changeQty(1)),this.qtyInput.addEventListener("input",()=>this.updateButtonPrice()),[this.radioSingle,this.radioSub].forEach(t=>t.addEventListener("change",()=>{this.purchaseType=t.value,this.togglePlanSelect(),this.updateButtonPrice()})),this.planSelect.addEventListener("change",()=>{let t=this.planSelect.selectedOptions[0].text.split("\u2014").pop().trim();this.subsPrice.textContent=t,this.updateButtonPrice()}),this.addBtn.addEventListener("click",t=>{t.preventDefault(),this.addToCart()})}onVariantChange(t){this.selectedVariant=this.variants.find(e=>e.id.toString()===t),this.selectedVariant&&(this.singlePrice.textContent=this.selectedVariant.priceFormatted,this.renderPlans(),this.updateButtonPrice())}renderPlans(){this.planSelect.innerHTML="",this.selectedVariant.selling_plans.forEach(t=>{let e=t.name.split(",")[0],n=document.createElement("option");n.value=t.price,n.dataset.planId=t.plan_id,n.textContent=e,this.planSelect.appendChild(n)}),this.radioSingle.checked=!0,this.purchaseType="single",this.togglePlanSelect()}togglePlanSelect(){this.planSelect.disabled=this.purchaseType!=="subscription"}changeQty(t){let e=parseInt(this.qtyInput.value,10)||1;e=Math.max(1,e+t),this.qtyInput.value=e,this.updateButtonPrice()}updateButtonPrice(){let e=(this.purchaseType==="single"?Number(this.selectedVariant.price):Number(this.planSelect.value))/100,n=Number(this.qtyInput.value)||1,i=e*n,a=i.toLocaleString("es-CO",{style:"currency",currency:"COP"});this.btnSurface.textContent=` ${a}`,this.setupTimer(i)}setupTimer(t){clearInterval(this.timerId);let e=Number(this.settings.freeShippingThreshold);if(t<e){this.timerBlock.style.display="flex",this.timerTextEl.textContent=this.settings.timerText,this.timerSuffix.textContent=this.settings.timerSuffix;let n=Date.now()+this.settings.timerDuration*6e4;this.runCountdown(n)}else this.timerBlock.style.display="none"}runCountdown(t){let e=()=>{let n=t-Date.now();if(n<=0){clearInterval(this.timerId),this.timerCountEl.textContent="00:00";return}let i=String(Math.floor(n/6e4)).padStart(2,"0"),a=String(Math.floor(n%6e4/1e3)).padStart(2,"0");this.timerCountEl.textContent=`${i}:${a}`};e(),this.timerId=setInterval(e,1e3)}addToCart(){if(!this.selectedVariant)return alert("Selecciona una variante.");let t={id:this.selectedVariant.id,quantity:Number(this.qtyInput.value)};this.purchaseType==="subscription"&&(t.selling_plan=this.planSelect.selectedOptions[0].dataset.planId),fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.ok?e.json():Promise.reject(e)).then(e=>console.log("[RavekitProduct] Cart response:",e)).catch(e=>console.error("[RavekitProduct] Cart error:",e))}};document.addEventListener("DOMContentLoaded",()=>{f(),h(),p(),document.querySelectorAll(".ravekit-product").forEach(s=>{new c(s)}),u(),d()});})();
