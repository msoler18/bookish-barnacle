(()=>{function m(){let n=document.querySelectorAll("[data-nutri-open]"),t=document.querySelector("[data-nutri-overlay]"),e=document.querySelector("[data-nutri-popup]"),i=document.querySelector("[data-nutri-close]");if(!n.length||!t||!e||!i)return;function s(){t.classList.remove("hidden"),e.classList.remove("hidden"),document.body.style.overflow="hidden"}function o(){t.classList.add("hidden"),e.classList.add("hidden"),document.body.style.overflow=""}n.forEach(r=>r.addEventListener("click",s)),t.addEventListener("click",o),i.addEventListener("click",o)}function y(){let n=document.querySelectorAll('a[href="#ravekit-product"]');n.length&&n.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();let i=document.getElementById("ravekit-product");i&&i.scrollIntoView({behavior:"smooth",block:"start"})})})}function E(n){let t=!1;return function(...e){t||(window.requestAnimationFrame(()=>{n(...e),t=!1}),t=!0)}}function S(){let n=Array.from(document.querySelectorAll("[data-parallax-speed]")).filter(r=>!r.hasAttribute("data-rotate-on-scroll")),t=Array.from(document.querySelectorAll("[data-rotate-on-scroll]")).filter(r=>!r.classList.contains("alien_ravekit")),e=Array.from(document.querySelectorAll(".alien_ravekit")),i=window.scrollY,s=.5,o=()=>{let r=window.scrollY,p=r-i;n.forEach(a=>{let l=a.dataset.parallaxSpeed,c=parseFloat(l);if(isNaN(c)||c===0)return;let u=`translateY(${r*-c}px)`;a.style.transform=u}),t.forEach(a=>{let l=a.dataset.rotateOnScroll,c=parseFloat(l);isNaN(c)||c===0||Math.abs(p)>s&&(a._angle=(a._angle||0)+p*c,a.style.transform=`rotate(${a._angle}deg)`)});let f=window.innerHeight;e.forEach(a=>{let l=a.getBoundingClientRect(),c=f-l.top,u=f+l.height,h=0;u>0&&(h=c/u),h=Math.min(Math.max(h,0),1);let q=h*180;a.style.transform=`rotate(${q}deg)`}),i=r};window.addEventListener("scroll",E(o),{passive:!0}),o()}function g(){let n=document.querySelectorAll("[data-accordion-trigger]"),t=document.querySelectorAll("[data-accordion-content]");if(!n.length||!t.length){console.warn("No titles or contents found for science accordion.");return}n.forEach(e=>{e.addEventListener("click",i=>{let s=e.dataset.index;n.forEach(r=>r.classList.remove("is-active")),t.forEach(r=>r.classList.remove("is-active")),e.classList.add("is-active");let o=document.querySelector(`.science-accordion__item-content[data-content-index="${s}"]`);o?o.classList.add("is-active"):console.warn("No content found for index:",s)})})}function v(){let n=document.querySelector("[data-banner-text]"),t=document.querySelector(".free-shipping-banner__spacer");if(!n||!t)return;let e=n.offsetHeight;t.style.height=`${e}px`;let i=n.getBoundingClientRect().top+window.scrollY;function s(){window.scrollY>=i?n.classList.add("free-shipping-banner__text-container--sticky"):n.classList.remove("free-shipping-banner__text-container--sticky")}window.addEventListener("scroll",s),s()}var d=class{constructor(t){this.container=t;let e=document.getElementById("RavekitProductData");this.data=e?JSON.parse(e.textContent):{},this.settings=this.data.settings||{},this.variants=this.data.variants||[],this.variantBtns=t.querySelectorAll(".variant-button"),this.qtyDec=t.querySelector(".quantity-decrease"),this.qtyInc=t.querySelector(".quantity-increase"),this.qtyInput=t.querySelector(".quantity-input"),this.addBtn=t.querySelector(".add-to-cart"),this.btnSurface=this.addBtn.querySelector(".push-btn__surface .btn-price"),this.radioSingle=t.querySelector('input[value="single"]'),this.radioSub=t.querySelector('input[value="subscription"]'),this.singlePrice=t.querySelector(".single-price"),this.subsPrice=t.querySelector(".subs-price"),this.planSelect=t.querySelector("#selling_plan_select"),this.timerBlock=t.querySelector(".free-shipping-timer"),this.timerTextEl=t.querySelector(".timer-text"),this.timerCountEl=t.querySelector(".timer-countdown"),this.timerSuffix=t.querySelector(".timer-suffix"),this.selectedVariant=null,this.purchaseType="single",this.timerId=null,this.init()}init(){this.variantBtns.length&&(this.variantBtns[0].classList.add("selected"),this.onVariantChange(this.variantBtns[0].dataset.variantId)),this.bind(),this.updateButtonPrice()}bind(){this.variantBtns.forEach(t=>t.addEventListener("click",()=>{this.variantBtns.forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),this.onVariantChange(t.dataset.variantId)})),this.qtyDec.addEventListener("click",()=>this.changeQty(-1)),this.qtyInc.addEventListener("click",()=>this.changeQty(1)),this.qtyInput.addEventListener("input",()=>this.updateButtonPrice()),[this.radioSingle,this.radioSub].forEach(t=>t.addEventListener("change",()=>{this.purchaseType=t.value,this.togglePlanSelect(),this.updateButtonPrice()})),this.planSelect.addEventListener("change",()=>{let t=this.planSelect.selectedOptions[0].text.split("\u2014").pop().trim();this.subsPrice.textContent=t,this.updateButtonPrice()}),this.addBtn.addEventListener("click",t=>{t.preventDefault(),this.addToCart()})}onVariantChange(t){this.selectedVariant=this.variants.find(e=>e.id.toString()===t),this.selectedVariant&&(this.singlePrice.textContent=this.selectedVariant.priceFormatted,this.renderPlans(),this.updateButtonPrice())}renderPlans(){this.planSelect.innerHTML="",this.selectedVariant.selling_plans.forEach(t=>{let e=t.name.split(",")[0],i=document.createElement("option");i.value=t.price,i.dataset.planId=t.plan_id,i.textContent=e,this.planSelect.appendChild(i)}),this.radioSingle.checked=!0,this.purchaseType="single",this.togglePlanSelect()}togglePlanSelect(){this.planSelect.disabled=this.purchaseType!=="subscription"}changeQty(t){let e=parseInt(this.qtyInput.value,10)||1;e=Math.max(1,e+t),this.qtyInput.value=e,this.updateButtonPrice()}updateButtonPrice(){let e=(this.purchaseType==="single"?Number(this.selectedVariant.price):Number(this.planSelect.value))/100,i=Number(this.qtyInput.value)||1,s=e*i,o=s.toLocaleString("es-CO",{style:"currency",currency:"COP"});this.btnSurface.textContent=` ${o}`,this.setupTimer(s)}setupTimer(t){clearInterval(this.timerId);let e=Number(this.settings.freeShippingThreshold);if(t<e){this.timerBlock.style.display="flex",this.timerTextEl.textContent=this.settings.timerText,this.timerSuffix.textContent=this.settings.timerSuffix;let i=Date.now()+this.settings.timerDuration*6e4;this.runCountdown(i)}else this.timerBlock.style.display="none"}runCountdown(t){let e=()=>{let i=t-Date.now();if(i<=0){clearInterval(this.timerId),this.timerCountEl.textContent="00:00";return}let s=String(Math.floor(i/6e4)).padStart(2,"0"),o=String(Math.floor(i%6e4/1e3)).padStart(2,"0");this.timerCountEl.textContent=`${s}:${o}`};e(),this.timerId=setInterval(e,1e3)}addToCart(){if(!this.selectedVariant)return alert("Selecciona una variante.");let t={id:this.selectedVariant.id,quantity:Number(this.qtyInput.value)};this.purchaseType==="subscription"&&(t.selling_plan=this.planSelect.selectedOptions[0].dataset.planId),fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.ok?e.json():Promise.reject(e)).then(e=>console.log("[RavekitProduct] Cart response:",e)).catch(e=>console.error("[RavekitProduct] Cart error:",e))}};document.addEventListener("DOMContentLoaded",()=>{v(),S(),g(),document.querySelectorAll(".ravekit-product").forEach(n=>{new d(n)}),y(),m()});})();
